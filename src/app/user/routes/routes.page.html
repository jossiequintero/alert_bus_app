<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/user/dashboard"></ion-back-button>
    </ion-buttons>
    <ion-title>Rutas de Autobús - Milagro</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="routes-header">
    <h1>Rutas Disponibles</h1>
    <p>Selecciona una ruta para ver sus paradas y autobuses en tiempo real</p>
  </div>

  <div class="routes-list" *ngIf="routes.length > 0">
    <ion-card *ngFor="let route of routes" (click)="selectRoute(route)" class="route-card">
      <ion-card-content>
        <div class="route-header">
          <div class="route-info">
            <h3>{{ route.name }}</h3>
            <p>{{ route.description }}</p>
          </div>
          <div class="route-stats">
            <ion-badge color="primary">{{ route.stops.length }} paradas</ion-badge>
            <ion-badge color="secondary">{{ route.estimatedDuration }} min</ion-badge>
          </div>
        </div>
        
        <div class="route-buses" *ngIf="getBusesForRoute(route.id).length > 0">
          <h4>Autobuses Activos:</h4>
          <div class="bus-list">
            <ion-chip *ngFor="let bus of getBusesForRoute(route.id)" color="success">
              <ion-icon name="bus"></ion-icon>
              <ion-label>{{ bus.number }}</ion-label>
            </ion-chip>
          </div>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <div class="selected-route" *ngIf="selectedRoute">
    <ion-card>
      <ion-card-header>
        <ion-card-title>{{ selectedRoute.name }}</ion-card-title>
        <ion-card-subtitle>{{ selectedRoute.description }}</ion-card-subtitle>
      </ion-card-header>
      
      <ion-card-content>
        <div class="route-map" *ngIf="selectedRoute">
          <google-map 
            [center]="mapCenter"
            [zoom]="13"
            [options]="mapOptions"
            width="100%"
            height="300px">
            
            <!-- Marcadores de paradas -->
            <map-marker 
              *ngFor="let stop of selectedRoute.stops; let i = index"
              [position]="{lat: stop.location.latitude, lng: stop.location.longitude}"
              [title]="stop.name"
              [label]="(i + 1).toString()"
              [options]="stopMarkerOptions">
            </map-marker>
            
            <!-- Marcadores de autobuses -->
            <ng-container *ngFor="let bus of getBusesForRoute(selectedRoute.id)">
              <map-marker 
                *ngIf="bus.currentLocation"
                [position]="{lat: bus.currentLocation.latitude, lng: bus.currentLocation.longitude}"
                [title]="'Autobús ' + bus.number"
                [options]="busMarkerOptions">
              </map-marker>
            </ng-container>
          </google-map>
        </div>

        <div class="stops-list">
          <h3>Paradas de la Ruta</h3>
          <ion-list>
            <ion-item *ngFor="let stop of selectedRoute.stops; let i = index">
              <ion-label>
                <h2>{{ i + 1 }}. {{ stop.name }}</h2>
                <p>{{ stop.description }}</p>
                <p>Coordenadas: {{ stop.location.latitude | number:'1.6-6' }}, {{ stop.location.longitude | number:'1.6-6' }}</p>
              </ion-label>
              <ion-button 
                slot="end" 
                fill="clear" 
                size="small"
                (click)="setAlertForStop(stop)">
                <ion-icon name="notifications-outline"></ion-icon>
              </ion-button>
            </ion-item>
          </ion-list>
        </div>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>
